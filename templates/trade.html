<!DOCTYPE html>
<html>
<head>
    <title>Paper Trade Options</title>
</head>
<body>
    <h1>ðŸ“ˆ Paper Trading Simulator</h1>
    {% if error %}<p style="color:red">{{ error }}</p>{% endif %}

    {% if not symbol %}
    <!-- Step 1: Enter Symbol -->
    <form method="POST">
        <label>Symbol: <input type="text" name="symbol" required></label>
        <button type="submit" name="load_expirations">Load Expirations</button>
    </form>
    {% else %}
    <!-- Step 2: Enter Trade Details -->
    <form method="POST">
        <label>Symbol: <input type="text" name="symbol" value="{{ symbol }}" readonly></label><br>
        <label>Option Type (call/put): <input type="text" name="type" required></label><br>
        <label>Strike Price: <input type="number" name="strike" step="0.01" required></label><br>
        <label>Quantity: <input type="number" name="quantity" required></label><br>
        <label>Expiration Date:
            <select name="expiration" required>
                {% for exp in expirations %}
                    <option value="{{ exp }}">{{ exp }}</option>
                {% endfor %}
            </select>
        </label><br>
        <button type="submit" name="submit_trade">Submit Trade</button>
    </form>
    <form method="POST">
        <button type="submit" name="reset">Back</button>
    </form>
    {% endif %}

    <hr>

    <h2>Your Trades</h2>
    {% for trade in trades %}
        <div style="border: 1px solid #ccc; padding: 10px; margin-bottom: 10px;">
            <strong>{{ trade.symbol }} ({{ trade.type }})</strong><br>
            Strike: {{ trade.strike }} | Qty: {{ trade.quantity }}<br>
            Expiration: {{ trade.expiration }}<br>
            Entry Option Price: {{ trade.entry_price }}<br>
            Status: {{ trade.status }}<br>
            {% if trade.status == 'open' %}
                Current Option Price:
                {% if trade.current_option_price is not none %}
                    {{ trade.current_option_price }}
                {% else %}
                    <em>Unavailable</em>
                {% endif %}<br>
                Unrealized P/L:
                {% if trade.unrealized_profit is not none %}
                    <strong>{{ trade.unrealized_profit }}</strong>
                {% else %}
                    <em>Unavailable</em>
                {% endif %}<br>
                <form method="POST" action="{{ url_for('paper_trading.close_trade', trade_id=trade.id) }}">
                    <button type="submit">Sell at Market</button>
                </form>
            {% else %}
                Exit Option Price: {{ trade.exit_price }}<br>
                Realized Profit: <strong>{{ trade.profit }}</strong>
            {% endif %}
        </div>
    {% endfor %}
</body>
</html>
